steps:
- script: 'choco install gitversion.portable --version=6.5.0'
  displayName: 'Install GitVersion'
  
- script: 'choco install nunit-console-runner --version=3.20.2'
  displayName: 'Install  nunit-console-runner'

- powershell: |
    Start-Process -FilePath "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" -ArgumentList @(
      "modify",
      "--installPath", "C:\Program Files (x86)\Microsoft Visual Studio\2022\Enterprise",
      "--add", "Microsoft.VisualStudio.Workload.Universal",
      "--includeRecommended",
      "--passive",
      "--norestart"
    ) -Wait
  displayName: "Install UWP workload"

- powershell: |
    Start-Process -FilePath "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" -ArgumentList @(
      "modify",
      "--installPath", "C:\Program Files (x86)\Microsoft Visual Studio\2022\Enterprise",
      "--add", "Microsoft.VisualStudio.Component.Windows10SDK.19041",
      "--includeRecommended",
      "--passive",
      "--norestart"
    ) -Wait
  displayName: "Install UWP workload"

# - script: '"C:\Android\android-sdk\cmdline-tools\latest\bin\sdkmanager" "platforms;android-33"'
#   displayName: 'Install Android platforms 33' 

# - script: '"C:\Android\android-sdk\cmdline-tools\latest\bin\sdkmanager" "platforms;android-34"'
#   displayName: 'Install Android platforms 34' 

- script: '"C:\Android\android-sdk\cmdline-tools\latest\bin\sdkmanager" "platforms;android-35"'
  displayName: 'Install Android platforms 35' 

- script: '"C:\Android\android-sdk\cmdline-tools\latest\bin\sdkmanager" "platforms;android-36"'
  displayName: 'Install Android platforms 36' 
  
- script: 'dotnet workload install android maui'
  displayName: 'Install .NET Android'
  
- task: JavaToolInstaller@0
  displayName: install JDK 17
  inputs:
    versionSpec: '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

# Install Xamarin.Android
- task: CmdLine@2
  displayName: 'Provisioning Xamarin.Android'
  retryCountOnTaskFailure: 2
  inputs:
    script: 'curl -OL https://github.com/codefoco/AzureDevopsTemplates/releases/download/v1.0/Xamarin.Android.Sdk-13.2.2.0.vsix'

- script: |
    echo "Installing VSIX extension..."
    "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\IDE\VSIXInstaller.exe" /quiet ".\Xamarin.Android.Sdk-13.2.2.0.vsix"
  displayName: 'Install VSIX extension'
  
# - task: CmdLine@2
#   displayName: 'Setup NDK path (due bug on NDK)'
#   inputs:
#     script: 'mklink /D Android "C:\Program Files (x86)\Android"'
#     workingDirectory: 'C:\'
