  steps:
  - task: InstallAppleCertificate@2
    inputs:
      certSecureFile: 'Dev.p12'
      certPwd: '$(DevCertPwd)'
      keychain: 'temp'
      
  - task: InstallAppleCertificate@2
    inputs:
      certSecureFile: 'Deploy.p12'
      certPwd: '$(DeployCertPwd)'
      keychain: 'temp'

  - task: InstallAppleProvisioningProfile@1
    inputs:
      provisioningProfileLocation: 'secureFiles'
      provProfileSecureFile: '0d6fe3df-fb0c-48eb-af91-9321c09913cd.mobileprovision'

  - task: InstallAppleProvisioningProfile@1
    inputs:
      provisioningProfileLocation: 'secureFiles'
      provProfileSecureFile: '8a51b462-c8e1-4cc7-bc2e-6f68ba6631b7.mobileprovision'

  - task: InstallAppleProvisioningProfile@1
    inputs:
      provisioningProfileLocation: 'secureFiles'
      provProfileSecureFile: 'ca446ca9-779f-4e69-97db-5b9820baf0ae.mobileprovision'

  # Install Mono
  - task: CmdLine@2
    displayName: 'Provisioning Mono SDK'
    inputs:
      script: 'cd ~;
              curl -O hhttps://download.visualstudio.microsoft.com/download/pr/15b48a0a-f363-47d8-9687-b7b59dbafd10/7fb3f0ff97647cb6c24bbdc36f2aad9c/monoframework-mdk-6.10.0.104.macos10.xamarin.universal.pkg;
              sudo installer -pkg ~/monoframework-mdk-6.10.0.104.macos10.xamarin.universal.pkg -target /'

  # Azure DevOps hosted pool is still using an old version of Xamarin.iOS, 
  # so we will upgrade
  - task: CmdLine@2
    displayName: 'Provisioning Xamarin.iOS'
    inputs:
      script: 'cd ~;
              curl -O https://download.visualstudio.microsoft.com/download/pr/15b48a0a-f363-47d8-9687-b7b59dbafd10/807a0eed1ab90172204134d590c03395/xamarin.ios-13.18.1.31.pkg;
              sudo installer -pkg ~/xamarin.ios-13.18.1.31.pkg -target /'

  - task: CmdLine@2
    displayName: 'Provisioning Xamarin.Mac'
    inputs:
      script: 'cd ~;
              curl -O https://download.visualstudio.microsoft.com/download/pr/15b48a0a-f363-47d8-9687-b7b59dbafd10/fc940b37a3b83bb2ed334f87ce11ac2d/xamarin.mac-6.18.1.31.pkg;
              sudo installer -pkg ~/xamarin.mac-6.18.1.31.pkg -target /'

  - task: CmdLine@2
    displayName: 'Provisioning Xamarin.Android'
    inputs:
      script: 'cd ~;
              curl -O https://download.visualstudio.microsoft.com/download/pr/15b48a0a-f363-47d8-9687-b7b59dbafd10/6f873caebecab207fadfd5813c197979/xamarin.android-10.3.1.0.pkg;
              sudo installer -pkg ~/xamarin.android-10.3.1.0.pkg -target /'

  # Install GitVersion
  - task: CmdLine@2
    displayName: 'Install GitVersion 5.2.4'
    inputs:
      script: 'cd ~;
              curl -OL https://github.com/GitTools/GitVersion/releases/download/5.2.4/gitversion-osx-5.2.4.tar.gz;
              tar -xvf gitversion-osx-5.2.4.tar.gz;
              mv gitversion /Applications/;
              sudo ln -s /Applications/gitversion /usr/local/bin/gitversion'

  # Print the current version of Xamarin.iOS
  - task: CmdLine@2
    displayName: 'Show Xamarin.iOS Version'
    inputs:
      script: '/Library/Frameworks/Xamarin.iOS.framework/Versions/Current/bin/mtouch --version'
